<!doctype html><html lang=ko class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.89.4">
<link rel=alternate type=application/rss+xml href=https://hhko.github.io/learned/dapr/helloworld/webapi-containerized/index.xml>
<meta name=robots content="index, follow">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>배움은 설렘이다</title>
<meta name=description content="dotnet new sln -o DaprMultiContainer
dotnet new webapp &ndash;no-https -o MyFrontEnd
dotnet sln add MyFrontEnd/
dotnet new webapi &ndash;no-https -o …">
<meta property="og:title" content>
<meta property="og:description" content="More fun with you">
<meta property="og:type" content="website">
<meta property="og:url" content="https://hhko.github.io/learned/dapr/helloworld/webapi-containerized/"><meta property="og:site_name" content="배움은 설렘이다">
<meta itemprop=name content>
<meta itemprop=description content="More fun with you"><meta name=twitter:card content="summary">
<meta name=twitter:title content>
<meta name=twitter:description content="More fun with you">
<link rel=preload href=/scss/main.min.90983698afafd407e6b72e83a2b749ff1726e8502277108f05bd66510938dec2.css as=style>
<link href=/scss/main.min.90983698afafd407e6b72e83a2b749ff1726e8502277108f05bd66510938dec2.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/>
<span class=navbar-logo></span><span class="text-uppercase font-weight-bold">배움은 설렘이다</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/learned/><span class=active>배움</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=https://github.com/hhko/hhko.github.io target=_blank><span>GitHub</span></a>
</li>
</ul>
</div>
<div class="navbar-nav d-none d-lg-block"></div>
</nav>
</header>
<div class="container-fluid td-default td-outer">
<main role=main class=td-main>
<p>dotnet new sln -o DaprMultiContainer</p>
<p>dotnet new webapp &ndash;no-https -o MyFrontEnd
dotnet sln add MyFrontEnd/</p>
<p>dotnet new webapi &ndash;no-https -o MyBackEnd
dotnet sln add MyBackEnd/</p>
<p>dapr list
dapr dashboard</p>
<p>dapr run &ndash;app-id mybackend &ndash;app-port 5000 &ndash;dapr-http-port 3500 dotnet run
ℹ️ Starting Dapr with id mybackend. HTTP Port: 3500. gRPC Port: 33797
&mldr;</p>
<p>== APP == Building&mldr;
ℹ️ Updating metadata for app command: dotnet run
✅ You&rsquo;re up and running! Both Dapr and your app logs will appear here.</p>
<p>== APP == info: Microsoft.Hosting.Lifetime[14]
== APP == Now listening on: http://localhost:5223
== APP == info: Microsoft.Hosting.Lifetime[0]
== APP == Application started. Press Ctrl+C to shut down.
== APP == info: Microsoft.Hosting.Lifetime[0]
== APP == Hosting environment: Development
== APP == info: Microsoft.Hosting.Lifetime[0]
== APP == Content root path: /github/DaprMultiContainer/MyBackEnd/</p>
<p>http://localhost:5223/WeatherForecast
http://localhost:3500/v1.0/invoke/mybackend/method/WeatherForecast</p>
<p>MyBackEnd - Dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:6.0 AS base
WORKDIR /app
EXPOSE 80</p>
<p>FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build
WORKDIR /src
COPY [&ldquo;MyBackEnd/MyBackEnd.csproj&rdquo;, &ldquo;MyBackEnd/"]
RUN dotnet restore &ldquo;MyBackEnd/MyBackEnd.csproj&rdquo;
COPY . .
WORKDIR &ldquo;/src/MyBackEnd&rdquo;
RUN dotnet build &ldquo;MyBackEnd.csproj&rdquo; -c Release -o /app/build</p>
<p>FROM build AS publish
RUN dotnet publish &ldquo;MyBackEnd.csproj&rdquo; -c Release -o /app/publish</p>
<p>FROM base AS final
WORKDIR /app
COPY &ndash;from=publish /app/publish .
ENTRYPOINT [&ldquo;dotnet&rdquo;, &ldquo;MyBackEnd.dll&rdquo;]</p>
<p>docker-compose.yml
version: &lsquo;3.4&rsquo;</p>
<p>services:
mybackend:
image: mybackend
build:
context: .
dockerfile: MyBackEnd/Dockerfile
ports:
- &ldquo;52000:50001&rdquo;</p>
<p>mybackend-dapr:
image: &ldquo;daprio/daprd:latest&rdquo;
command: [ &ldquo;./daprd&rdquo;, &ldquo;-app-id&rdquo;, &ldquo;MyBackEnd&rdquo;, &ldquo;-app-port&rdquo;, &ldquo;80&rdquo; ]
depends_on:
- mybackend
network_mode: &ldquo;service:mybackend&rdquo;</p>
<p>1.5.1
1.5.1-linux-amd64
1.5.1-windows-amd64</p>
<p>Compose file format : 3.4
Docker Engine release : 17.09.0+</p>
<p>DaprMultiContainer</p>
<p>.NET Core Web App
&ndash;no-https</p>
<p>MyFrontEnd</p>
<p>Install-Package Dapr.AspNetCore</p>
<p>Program.cs
builder.Services.AddDaprClient();</p>
<p>WeatherForecast.cs
namespace MyFrontEnd;</p>
<p>public class WeatherForecast
{
public DateTime Date { get; set; }</p>
<pre><code>public int TemperatureC { get; set; }

public int TemperatureF { get; set; }

public string Summary { get; set; } = string.Empty;
</code></pre>
<p>}</p>
<p>index.cshtml
using Dapr.Client;
using Microsoft.AspNetCore.Mvc.RazorPages;</p>
<p>namespace MyFrontEnd.Pages;</p>
<p>public class IndexModel : PageModel
{
private readonly DaprClient _daprClient;</p>
<pre><code>public IndexModel(DaprClient daprClient)
{
    _daprClient = daprClient;
}

public async Task OnGet()
{
    var forecasts = await _daprClient.InvokeMethodAsync&lt;IEnumerable&lt;WeatherForecast&gt;&gt;(
        HttpMethod.Get,
        &quot;MyBackEnd&quot;,
        &quot;weatherforecast&quot;);

    ViewData[&quot;WeatherForecastData&quot;] = forecasts;
}
</code></pre>
<p>}</p>
<ul>
<li>OnGet메서드는 사용자가 홈 페이지를 방문할 때마다 호출 됩니다.</li>
</ul>
<p>@page
@model IndexModel
@{
ViewData[&ldquo;Title&rdquo;] = &ldquo;Home page&rdquo;;
}</p>
<p>Docker-compose.ci.build.yml
version: &lsquo;3.4&rsquo;</p>
<p>services:
myfrontend:
image: ${DOCKER_REGISTRY-}myfrontend
build:
context: .
dockerfile: MyFrontEnd/Dockerfile</p>
<p>Dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:6.0 AS base
WORKDIR /app
EXPOSE 80
EXPOSE 443</p>
<p>FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build
WORKDIR /src
COPY [&ldquo;MyFrontEnd/MyFrontEnd.csproj&rdquo;, &ldquo;MyFrontEnd/"]
RUN dotnet restore &ldquo;MyFrontEnd/MyFrontEnd.csproj&rdquo;
COPY . .
WORKDIR &ldquo;/src/MyFrontEnd&rdquo;
RUN dotnet build &ldquo;MyFrontEnd.csproj&rdquo; -c Release -o /app/build</p>
<p>FROM build AS publish
RUN dotnet publish &ldquo;MyFrontEnd.csproj&rdquo; -c Release -o /app/publish</p>
<p>FROM base AS final
WORKDIR /app
COPY &ndash;from=publish /app/publish .
ENTRYPOINT [&ldquo;dotnet&rdquo;, &ldquo;MyFrontEnd.dll&rdquo;]</p>
<p>.NET Core Web API
MyBackEnd</p>
<p>Dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:6.0 AS base
WORKDIR /app
EXPOSE 80</p>
<p>FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build
WORKDIR /src
COPY [&ldquo;MyBackEnd/MyBackEnd.csproj&rdquo;, &ldquo;MyBackEnd/"]
RUN dotnet restore &ldquo;MyBackEnd/MyBackEnd.csproj&rdquo;
COPY . .
WORKDIR &ldquo;/src/MyBackEnd&rdquo;
RUN dotnet build &ldquo;MyBackEnd.csproj&rdquo; -c Release -o /app/build</p>
<p>FROM build AS publish
RUN dotnet publish &ldquo;MyBackEnd.csproj&rdquo; -c Release -o /app/publish</p>
<p>FROM base AS final
WORKDIR /app
COPY &ndash;from=publish /app/publish .
ENTRYPOINT [&ldquo;dotnet&rdquo;, &ldquo;MyBackEnd.dll&rdquo;]</p>
<p>Docker-compose.ci.build.yml
version: &lsquo;3.4&rsquo;</p>
<p>services:
myfrontend:
image: ${DOCKER_REGISTRY-}myfrontend
build:
context: .
dockerfile: MyFrontEnd/Dockerfile</p>
<p>mybackend:
image: ${DOCKER_REGISTRY-}mybackend
build:
context: .
dockerfile: MyBackEnd/Dockerfile</p>
<p>Docker-compose.ci.build.yml
version: &lsquo;3.4&rsquo;</p>
<p>services:
myfrontend:
image: ${DOCKER_REGISTRY-}myfrontend
build:
context: .
dockerfile: MyFrontEnd/Dockerfile
ports:
- &ldquo;51000:50001&rdquo;</p>
<p>myfrontend-dapr:
image: &ldquo;daprio/daprd:latest&rdquo;
command: [ &ldquo;./daprd&rdquo;, &ldquo;-app-id&rdquo;, &ldquo;MyFrontEnd&rdquo;, &ldquo;-app-port&rdquo;, &ldquo;80&rdquo; ]
depends_on:
- myfrontend
network_mode: &ldquo;service:myfrontend&rdquo;</p>
<p>mybackend:
image: ${DOCKER_REGISTRY-}mybackend
build:
context: .
dockerfile: MyBackEnd/Dockerfile
ports:
- &ldquo;52000:50001&rdquo;</p>
<p>mybackend-dapr:
image: &ldquo;daprio/daprd:latest&rdquo;
command: [ &ldquo;./daprd&rdquo;, &ldquo;-app-id&rdquo;, &ldquo;MyBackEnd&rdquo;, &ldquo;-app-port&rdquo;, &ldquo;80&rdquo; ]
depends_on:
- mybackend
network_mode: &ldquo;service:mybackend&rdquo;</p>
<p>daprio/daprd:latest ->
gRPC 50001?</p>
</main>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.391da3eb18949eadd765f25289a14a0b83052a94db796648e9785f4b2a98f3a9.js integrity="sha256-OR2j6xiUnq3XZfJSiaFKC4MFKpTbeWZI6XhfSyqY86k=" crossorigin=anonymous></script>
</body>
</html>